(function(){var e,t,n,i,o,r,a={maxWidth:1024,maxHeight:1024,quality:100,multiple:!0,allowedExtensions:"png|jpeg|jpg|gif",previewId:!1,outputName:"myfiles[]",callback:!1,error:!1,befsend:!1};window.URL=window.URL||window.webkitURL,t=function(e,t){var n,i={};for(n in e)i[n]=e[n];for(n in t)i[n]=t[n];return i},n=function(e,t){var n=new FileReader;n.addEventListener("load",function(){var n=new Image;n.addEventListener("load",function(){r(e,this,t._options.quality,"jpeg",t)}),n.src=window.URL.createObjectURL(e),window.URL.revokeObjectURL(e)}),n.readAsDataURL(e)},r=function(e,t,n,r,a){var s,l,d,p,u,c="image/jpeg";"undefined"!=typeof r&&"png"==r&&(c="image/png"),d=t.naturalWidth/t.naturalHeight,s=t.naturalWidth>a._options.maxWidth?a._options.maxWidth:t.naturalWidth,l=s/d,p=document.createElement("canvas"),p.width=s,p.height=l,u=p.getContext("2d").drawImage(t,0,0,s,l),p.toBlob(function(t){var n=t;n.type=e.type,n.myname=e.name,n.lastModified=e.lastModified,a._options.multiple?(a.filesArray.push(n),a.preview&&i(p,n,a)):(a.filesArray[0]=n,a.preview&&(o(a),i(p,n,a)))},c,n/100)},i=function(e,t,n){var i,o=document.createElement("div"),r=document.createElement("span");o.setAttribute("class","iPreview"),r.setAttribute("class","iPreview-delete"),r.innerHTML="&times;",o.appendChild(e),o.appendChild(r),n.preview.appendChild(o),r.addEventListener("click",function(e){i=n.filesArray.indexOf(t),i>-1&&n.filesArray.splice(i,1),preview.removeChild(o)})},o=function(e){var t=e.preview.getElementsByClassName("iPreview");Array.prototype.forEach.call(t,function(t){e.preview.removeChild(t)})},e=function(e,n){this._element=document.getElementById(e),this._form=this._element.form,this._options=t(a,n),this.filesArray=[],this.init()},e.prototype.init=function(){this._options.previewId&&(this.preview=document.getElementById(this._options.previewId)||!1),this.preview&&this.setPreviewContainer();var e=this;this._element.addEventListener("change",function(){var t=this.files;if(t&&t[0])for(var i=0;i<t.length;i++){var o=t[i],r=new RegExp(".("+e._options.allowedExtensions+")$","i");r.test(o.name)&&/\.(png|jpeg|jpg|gif)$/i.test(o.name)&&n(o,e)}}),this._form.addEventListener("submit",function(t){t.preventDefault();var n,i,o,r,a;o=function(t){e._options.befsend&&e._options.befsend.call(this,t,e)},r=function(t){e._options.error&&e._options.error.call(this,t,e)},a=function(t){e._options.callback&&e._options.callback.call(this,t,e)},e._element.value="",n=this.getAttribute("action");var s=new FormData(e._form);for(i=0;i<e.filesArray.length;i++)s.append(e._options.outputName,e.filesArray[i],e.filesArray[i].myname);var l=new XMLHttpRequest;l.upload.addEventListener("progress",function(t){e._progress.setAttribute("value",Math.floor(t.loaded/t.total*100))},!1),l.onreadystatechange=function(){if(2==l.readyState&&o&&"function"==typeof o&&o(l),4===l.readyState){if(200!==l.status)return void(r&&"function"==typeof r&&r(l.responseText));a&&"function"==typeof a&&a(l.responseText)}},l.open("POST",n,!0),l.send(s)})},e.prototype.setPreviewContainer=function(){var e=document.createElement("div");e.setAttribute("class","cjs-p-c"),e.style.display="none";var t=document.createElement("progress");t.setAttribute("class","cjs-p"),t.setAttribute("max","100"),t.setAttribute("value","0"),e.appendChild(t),this.preview.appendChild(e),this.progressContainer=e,this._progress=t},this.CompressorJs=e}).call(this),function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),i=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),o=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,r=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,a=(n||o)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,a,s,l,d,p,u,c,f;if(t=e.match(r),!t)throw new Error("invalid data URI");for(a=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),s=!!t[4],l=e.slice(t[0].length),d=s?atob(l):decodeURIComponent(l),p=new ArrayBuffer(d.length),u=new Uint8Array(p),c=0;c<d.length;c+=1)u[c]=d.charCodeAt(c);return n?new Blob([i?u:p],{type:a}):(f=new o,f.append(p),f.getBlob(a))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,i){e(i&&t.toDataURL&&a?a(this.toDataURL(n,i)):this.mozGetAsFile("blob",n))}:t.toDataURL&&a&&(t.toBlob=function(e,t,n){e(a(this.toDataURL(t,n)))})),"function"==typeof define&&define.amd?define(function(){return a}):"object"==typeof module&&module.exports?module.exports=a:e.dataURLtoBlob=a}(window);